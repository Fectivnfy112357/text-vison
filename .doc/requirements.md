# 文生视界小程序登录集成与API修复 - 软件需求文档

## 1. 项目概述与目标

### 项目背景
文生视界是一个AI内容生成平台，目前包含Web前端、移动端和微信小程序三个客户端。当前存在以下问题：
1. 小程序缺少微信登录功能，无法与现有登录鉴权体系集成
2. 小程序API调用与后端接口不匹配，接口名称、参数和响应格式存在差异
3. 小程序无法正常使用后端提供的功能

### 项目目标
1. **集成微信小程序登录**：开发微信小程序登录功能，融合到现有的JWT登录鉴权体系中
2. **修复API接口不匹配问题**：统一小程序与后端的API接口规范
3. **确保功能一致性**：保证小程序能够正常使用所有后端功能

## 2. 用户角色
* **微信小程序用户**：通过微信小程序使用文生视界服务的用户，需要通过微信授权登录
* **系统管理员**：负责用户管理和系统维护的管理员
* **开发人员**：负责维护和开发系统功能的技术人员

## 3. 功能需求与用户故事

### Epic 1: 微信小程序登录集成
---
#### User Story: AUTH-001
> 作为一个**微信小程序用户**，我希望能够**通过微信授权快速登录**，这样我就可以**无需注册即可使用平台服务**。

##### 验收标准:
- [ ] AC-1: 用户可以通过微信授权获取用户信息并完成登录
- [ ] AC-2: 系统能够获取微信用户的openid和unionid
- [ ] AC-3: 登录成功后返回JWT token，与现有鉴权体系兼容
- [ ] AC-4: 首次登录自动创建用户账户
- [ ] AC-5: 登录响应时间不超过3秒

---
#### User Story: AUTH-002
> 作为一个**系统**，我需要**安全地处理微信登录流程**，这样我就可以**保护用户数据安全**。

##### 验收标准:
- [ ] AC-1: 验证微信code的有效性
- [ ] AC-2: 安全存储用户的微信信息
- [ ] AC-3: 实现token刷新机制
- [ ] AC-4: 记录用户登录日志
- [ ] AC-5: 处理登录异常情况

---
### Epic 2: API接口规范化
---
#### User Story: API-001
> 作为一个**开发人员**，我需要**统一小程序与后端的API接口**，这样我就可以**确保功能正常运行**。

##### 验收标准:
- [ ] AC-1: 修复用户认证相关API接口路径不匹配问题
- [ ] AC-2: 统一模板管理API的参数和响应格式
- [ ] AC-3: 修复内容生成API的接口调用
- [ ] AC-4: 统一文件上传API规范
- [ ] AC-5: 确保所有API返回统一的响应格式

---
#### User Story: API-002
> 作为一个**微信小程序用户**，我希望**所有功能都能正常使用**，这样我就可以**完整体验平台服务**。

##### 验收标准:
- [ ] AC-1: 能够正常浏览和使用模板
- [ ] AC-2: 能够正常生成图片和视频内容
- [ ] AC-3: 能够查看生成历史记录
- [ ] AC-4: 能够管理个人信息
- [ ] AC-5: 所有功能响应时间在可接受范围内

---
### Epic 3: 后端微信登录支持
---
#### User Story: BACKEND-001
> 作为一个**后端系统**，我需要**提供微信登录API接口**，这样我就可以**支持小程序用户登录**。

##### 验收标准:
- [ ] AC-1: 实现 `/api/auth/wx-login` 接口
- [ ] AC-2: 集成微信API获取用户信息
- [ ] AC-3: 实现微信用户与系统用户的关联
- [ ] AC-4: 支持微信用户信息更新
- [ ] AC-5: 提供微信登录状态检查接口

---
### Epic 4: 数据一致性保障
---
#### User Story: DATA-001
> 作为一个**系统管理员**，我需要**确保不同客户端的数据一致性**，这样我就可以**提供统一的用户体验**。

##### 验收标准:
- [ ] AC-1: 微信用户与Web用户使用相同的数据模型
- [ ] AC-2: 用户生成的内容在所有客户端同步
- [ ] AC-3: 用户配置和偏好设置保持一致
- [ ] AC-4: 操作日志完整记录
- [ ] AC-5: 支持跨平台用户数据迁移
